<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Priority Scheduling Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1,
    h2 {
      text-align: center;
      color: #2c3e50;
    }

    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    .btn:hover {
      background: #2980b9;
    }

    input[type="number"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th,
    td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    .gantt-chart {
      margin: 30px 0;
    }

    .gantt-container {
      display: flex;
      margin-bottom: 5px;
    }

    .gantt-block {
      padding: 10px 0;
      color: white;
      font-weight: bold;
      text-align: center;
      border-right: 1px solid white;
    }

    .gantt-time {
      position: relative;
      height: 20px;
    }

    .time-marker {
      position: absolute;
      font-size: 10px;
      transform: translateX(-50%);
      white-space: nowrap;
    }

    .error {
      color: red;
      margin-top: 5px;
    }

    .info-text {
      background: #e8f4fc;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Priority Scheduling Simulator</h1>
    <div class="info-text">
      <strong>Note:</strong> Lower priority numbers are executed first.
    </div>

    <!-- Input Section -->
    <div>
      <label for="num-processes">Number of Processes (1-20):</label>
      <input type="number" id="num-processes" min="1" max="20" value="3">
      <div id="process-error" class="error"></div>
      <button class="btn" id="generate-btn">Generate Table</button>
    </div>

    <!-- Process Table -->
    <div id="process-input" style="display: none;">
      <table>
        <thead>
          <tr>
            <th>Process</th>
            <th>Arrival Time</th>
            <th>Burst Time</th>
            <th>Priority</th>
          </tr>
        </thead>
        <tbody id="process-tbody"></tbody>
      </table>
      <div id="input-error" class="error"></div>
      <button class="btn" id="calculate-btn">Calculate</button>
    </div>

    <!-- Results -->
    <div id="results" style="display: none;">
      <h2>Gantt Chart</h2>
      <div class="gantt-chart">
        <div id="gantt-blocks" class="gantt-container"></div>
        <div id="gantt-times" class="gantt-time"></div>
      </div>

      <h2>Results</h2>
      <table>
        <thead>
          <tr>
            <th>Process</th>
            <th>Arrival</th>
            <th>Burst</th>
            <th>Priority</th>
            <th>Completion</th>
            <th>Turnaround</th>
            <th>Waiting</th>
            <th>Response</th>
          </tr>
        </thead>
        <tbody id="results-tbody"></tbody>
      </table>

      <table>
        <thead>
          <tr>
            <th>Avg Waiting</th>
            <th>Avg Turnaround</th>
            <th>Avg Response</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="avg-waiting">-</td>
            <td id="avg-turnaround">-</td>
            <td id="avg-response">-</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
      // === DOM Elements ===
      const numInput = document.getElementById('num-processes');
      const generateBtn = document.getElementById('generate-btn');
      const processTbody = document.getElementById('process-tbody');
      const processInput = document.getElementById('process-input');
      const calculateBtn = document.getElementById('calculate-btn');
      const results = document.getElementById('results');
      const resultsTbody = document.getElementById('results-tbody');
      const ganttBlocks = document.getElementById('gantt-blocks');
      const ganttTimes = document.getElementById('gantt-times');
      const processError = document.getElementById('process-error');
      const inputError = document.getElementById('input-error');
      const avgWaiting = document.getElementById('avg-waiting');
      const avgTurnaround = document.getElementById('avg-turnaround');
      const avgResponse = document.getElementById('avg-response');

      const generateColors = count => {
            
            const colors = [];

            for (let i = 0; i < count; i++) 
            {
                  const hue = (i * 137) % 360;
                  colors.push(`hsl(${hue}, 70%, 60%)`);
            }

            return colors;
      };

      generateBtn.onclick = () => {

            const n = parseInt(numInput.value);

            if (isNaN(n) || n < 1 || n > 20) 
            {
                  processError.textContent = 'Please enter a number between 1 and 20.';
                  return;
            }

            processError.textContent = '';
            processTbody.innerHTML = '';

            for (let i = 0; i < n; i++) 
            {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                  <td>P${i + 1}</td>
                  <td><input type="number" class="arrival-time" min="0" value="${i}"></td>
                  <td><input type="number" class="burst-time" min="1" value="${Math.floor(Math.random() * 10) + 1}"></td>
                  <td><input type="number" class="priority" min="1" value="${Math.floor(Math.random() * 10) + 1}"></td>
                  `;
                  processTbody.appendChild(row);
            }

            processInput.style.display = 'block';
            results.style.display = 'none';
      };

      calculateBtn.onclick = () => {

            const arrivals = [...document.querySelectorAll('.arrival-time')];
            const bursts = [...document.querySelectorAll('.burst-time')];
            const priorities = [...document.querySelectorAll('.priority')];

            const processes = [];
            for (let i = 0; i < arrivals.length; i++) 
            {
                  const at = parseInt(arrivals[i].value);
                  const bt = parseInt(bursts[i].value);
                  const pr = parseInt(priorities[i].value);
                  if (isNaN(at) || at < 0 || isNaN(bt) || bt < 1 || isNaN(pr) || pr < 1) 
                  {
                        inputError.textContent = `Invalid input at row ${i + 1}`;
                        return;
                  }

                  processes.push({ id: i + 1, arrivalTime: at, burstTime: bt, priority: pr });
            }
            
            inputError.textContent = '';
            const result = priorityScheduling(processes);
            displayResults(result, processes);
      };

      function priorityScheduling(processes) 
      {
            const n = processes.length;
            const proc = processes.map(p => ({ ...p, remainingTime: p.burstTime }));
            const gantt = [], completed = Array(n).fill(false), firstStart = Array(n).fill(-1);
            let currentTime = 0, done = 0;

            while (done < n) 
            {
                  let idx = -1, best = Infinity;
                  for (let i = 0; i < n; i++) 
                  {
                        if (!completed[i] && proc[i].arrivalTime <= currentTime) 
                        {
                              if (proc[i].priority < best ||
                                 (proc[i].priority === best && proc[i].arrivalTime < proc[idx]?.arrivalTime)) 
                              {
                                  
                                    best = proc[i].priority;
                                    idx = i;
                              }
                        }
                  }

                  if (idx === -1) 
                  {
                        gantt.push({ processId: 0, start: currentTime, end: currentTime + 1 });
                        currentTime++;
                  } 
                  else 
                  {
                        if (firstStart[idx] === -1) firstStart[idx] = currentTime;

                        const p = proc[idx];
                        gantt.push({ processId: p.id, start: currentTime, end: currentTime + p.remainingTime });
                        currentTime += p.remainingTime;
                        completed[idx] = true;
                        done++;
                        p.completionTime = currentTime;
                        p.turnaroundTime = currentTime - p.arrivalTime;
                        p.waitingTime = p.turnaroundTime - p.burstTime;
                        p.responseTime = firstStart[idx] - p.arrivalTime;
                  }
            }

            const avgW = proc.reduce((a, p) => a + p.waitingTime, 0) / n;
            const avgT = proc.reduce((a, p) => a + p.turnaroundTime, 0) / n;
            const avgR = proc.reduce((a, p) => a + p.responseTime, 0) / n;

            return { processes: proc, gantt, avgW, avgT, avgR };
      }

      function displayResults(result, original) 
      {
            resultsTbody.innerHTML = '';
            ganttBlocks.innerHTML = '';
            ganttTimes.innerHTML = '';

            const colors = generateColors(original.length);
            const totalTime = result.gantt[result.gantt.length - 1].end;

            // Table
            result.processes.sort((a, b) => a.id - b.id).forEach(p => {
                  resultsTbody.innerHTML += `
                  <tr>
                  <td>P${p.id}</td><td>${p.arrivalTime}</td><td>${p.burstTime}</td><td>${p.priority}</td>
                  <td>${p.completionTime}</td><td>${p.turnaroundTime}</td>
                  <td>${p.waitingTime}</td><td>${p.responseTime}</td>
                  </tr>`;
            });

            avgWaiting.textContent = result.avgW.toFixed(2);
            avgTurnaround.textContent = result.avgT.toFixed(2);
            avgResponse.textContent = result.avgR.toFixed(2);

            const timeSet = new Set();

            result.gantt.forEach(block => {
                  
                  const duration = block.end - block.start;
                  const width = (duration / totalTime) * 100;

                  const div = document.createElement('div');
                  div.className = 'gantt-block';
                  div.style.width = width + '%';
                  div.style.backgroundColor = block.processId === 0 ? '#bbb' : colors[block.processId - 1];
                  div.textContent = block.processId === 0 ? 'Idle' : `P${block.processId}`;
                  ganttBlocks.appendChild(div);

                  if (!timeSet.has(block.start)) 
                  {
                        const t = document.createElement('div');
                        t.className = 'time-marker';
                        t.textContent = block.start;
                        t.style.left = `${(block.start / totalTime) * 100}%`;
                        ganttTimes.appendChild(t);
                        timeSet.add(block.start);
                  }
            });

            const endMarker = document.createElement('div');
            endMarker.className = 'time-marker';
            endMarker.textContent = result.gantt[result.gantt.length - 1].end;
            endMarker.style.left = `100%`;
            ganttTimes.appendChild(endMarker);

            results.style.display = 'block';
      }

      // Auto-init
      generateBtn.click();

  </script>
</body>

</html>